/*!
 * ng-obiba-mica - v1.0.0
 * https://github.com/obiba/ng-obiba-mica

 * License: GNU Public License version 3
 * Date: 2016-02-04
 */
"use strict";function NgObibaMicaUrlProvider(){function a(a){var b=a;this.getUrl=function(a){return a in b?b[a]:null}}var b={DataAccessFormConfigResource:"ws/config/data-access-form",DataAccessRequestsResource:"ws/data-access-requests",DataAccessRequestResource:"ws/data-access-request/:id",DataAccessRequestAttachmentDownloadResource:"/ws/data-access-request/:id/attachments/:attachmentId/_download",DataAccessRequestDownloadPdfResource:"/ws/data-access-request/:id/_pdf",DataAccessRequestCommentsResource:"ws/data-access-request/:id/comments",DataAccessRequestCommentResource:"ws/data-access-request/:id/comment/:commentId",DataAccessRequestStatusResource:"ws/data-access-request/:id/_status?to=:status",TempFileUploadResource:"ws/files/temp",TempFileResource:"ws/files/temp/:id",PublishedStudiesSearchResource:"ws/:type/_search",TaxonomiesSearchResource:"ws/taxonomies/_search",TaxonomiesResource:"ws/taxonomies/_filter",TaxonomyResource:"ws/taxonomy/:taxonomy/_filter",VocabularyResource:"ws/taxonomy/:taxonomy/vocabulary/:vocabulary/_filter",JoinQuerySearchResource:"ws/:type/_rql?:query",JoinQueryCoverageResource:"ws/variables/_coverage?:query"};this.setUrl=function(a,c){a in b&&(b[a]=c)},this.$get=function(){return new a(b)}}function NgObibaMicaTemplateUrlFactory(){function a(a){var b=a;this.getHeaderUrl=function(a){return a in b?b[a].header:null},this.getFooterUrl=function(a){return a in b?b[a].footer:null}}var b={registry:null};b.setHeaderUrl=function(a,b){a in this.registry&&(this.registry[a].header=b)},b.setFooterUrl=function(a,b){a in this.registry&&(this.registry[a].footer=b)},b.$get=function(){return new a(this.registry)},this.create=function(a){return b.registry=a,b}}function targetToType(a){switch(a.toLocaleString()){case"network":return"networks";case"study":return"studies";case"dataset":return"datasets";case"variable":return"variables"}throw new Error("Invalid target: "+a)}function CriteriaItemBuilder(a,b){var c={id:"",taxonomy:[],vocabulary:[],term:null,selectedTerms:[],target:"",lang:b,itemTitle:"",itemDescription:"",itemParentTitle:"",itemParentDescription:""};this.target=function(a){return c.target=a,this},this.taxonomy=function(a){return c.taxonomy=a,this},this.vocabulary=function(a){return c.vocabulary=a,this},this.term=function(a){return c.term=a,this},this.selectedTerm=function(a){return c.selectedTerms.push(a),this},this.selectedTerms=function(a){return c.selectedTerms=a,this},this.build=function(){return c.id=c.taxonomy.name+"::"+c.vocabulary.name,c.term?(c.id+=":"+c.term.name,c.itemTitle=a.forLocale(c.term.title,c.lang),c.itemDescription=a.forLocale(c.term.description,c.lang),c.itemParentTitle=a.forLocale(c.vocabulary.title,c.lang),c.itemParentDescription=a.forLocale(c.vocabulary.description,c.lang),c.itemTitle||(c.itemTitle=c.term.name),c.itemParentTitle||(c.itemParentTitle=c.vocabulary.name)):(c.itemTitle=a.forLocale(c.vocabulary.title,c.lang),c.itemDescription=a.forLocale(c.vocabulary.description,c.lang),c.itemParentTitle=a.forLocale(c.taxonomy.title,c.lang),c.itemParentDescription=a.forLocale(c.taxonomy.description,c.lang),c.itemTitle||(c.itemTitle=c.vocabulary.name),c.itemParentTitle||(c.itemParentTitle=c.taxonomy.name)),c}}function AbstractCriteriaBuilder(a,b,c,d){this.target=null,this.root=a,this.taxonomies=b,this.criteriaList=[],this.LocalizedValues=c,this.lang=d,this.addCriteria=function(a,b,c){var d=this,e=this.taxonomies.filter(function(b){return a===b.name});if(0===e.length)throw new Error("Could not find taxonomy:",a);e=e[0];var f=e.vocabularies.filter(function(a){return b===a.name});if(0===f.length)throw new Error("Could not find vocabulary:",b);var g=0;f=f[0];var h=new CriteriaItemBuilder(d.LocalizedValues,d.lang).target(d.target).taxonomy(e).vocabulary(f);f.terms&&f.terms.some(function(a){return-1!==c.indexOf(a.name)?(h.selectedTerm(a).build(),g++,g===c.length):void 0}),d.criteriaList.push(h.build())}}function GraphicChartsDataProvider(){function a(a){var b=a;this.getData=function(a){a&&b.$promise.then(a)}}this.$get=function(b,c,d){var e=d.queryDtoBuilder(c.getOptions().entityIds);return new a(b.get({type:c.getOptions().entityType,id:c.getOptions().entityIds},e))}}angular.module("ngObibaMica",["schemaForm","obiba.mica.utils","obiba.mica.file","obiba.mica.attachment","obiba.mica.access","obiba.mica.search","obiba.mica.graphics","obiba.mica.localized"]).constant("USER_ROLES",{all:"*",admin:"mica-administrator",reviewer:"mica-reviewer",editor:"mica-editor",user:"mica-user",dao:"mica-data-access-officer"}).config(["$provide",function(a){a.provider("ngObibaMicaUrl",NgObibaMicaUrlProvider)}]),angular.module("obiba.mica.utils",[]).factory("UserProfileService",function(){var a=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};return{getAttribute:function(b,c){return a(b,c)},getFullName:function(b){return b?b.attributes?a(b.attributes,"firstName")+" "+a(b.attributes,"lastName"):b.username:null}}}),angular.module("obiba.mica.file",["ngResource"]),angular.module("obiba.mica.file").filter("bytes",function(){return function(a){return null===a||"undefined"==typeof a?"":filesize(a)}}),angular.module("obiba.mica.file").factory("TempFileResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TempFileResource"),{},{get:{method:"GET"},"delete":{method:"DELETE"}})}]),angular.module("obiba.mica.attachment",["obiba.mica.file","ui","ui.bootstrap","ngFileUpload","templates-ngObibaMica"]),angular.module("obiba.mica.attachment").directive("attachmentList",[function(){return{restrict:"E",scope:{hrefBuilder:"&",files:"="},templateUrl:"attachment/attachment-list-template.html",link:function(a){a.attachments=[],a.hrefBuilder=a.hrefBuilder||function(a){return a.id},a.$watch("files",function(b){b&&(a.attachments=b.map(function(b){var c=angular.copy(b);return c.href=a.hrefBuilder({id:b.id}),c}))},!0)}}}]).directive("attachmentInput",[function(){return{restrict:"E",require:"^form",scope:{multiple:"=",accept:"@",files:"="},templateUrl:"attachment/attachment-input-template.html",controller:"AttachmentCtrl"}}]).controller("AttachmentCtrl",["$scope","$timeout","$log","Upload","TempFileResource","ngObibaMicaUrl",function(a,b,c,d,e,f){var g=function(g){c.debug("file",g);var h={showProgressBar:!0,lang:"en",progress:0,fileName:g.name,size:g.size};a.multiple?a.files.push(h):(a.files.splice(0,a.files.length),a.files.push(h)),a.upload=d.upload({url:f.getUrl("TempFileUploadResource"),method:"POST",file:g}).progress(function(a){h.progress=parseInt(100*a.loaded/a.total)}).success(function(a,d,f){var g=f().location.split("/"),i=g[g.length-1];e.get({id:i},function(a){c.debug("tempFile",a),h.id=a.id,h.md5=a.md5,h.justUploaded=!0,b(function(){h.showProgressBar=!1},1e3)})})};a.onFileSelect=function(b){a.uploadedFiles=b,a.uploadedFiles.forEach(function(a){g(a)})},a.deleteTempFile=function(b){e["delete"]({id:b},function(){for(var c=a.files.length;c--;){var d=a.files[c];d.justUploaded&&d.id===b&&a.files.splice(c,1)}})},a.deleteFile=function(b){for(var c=a.files.length;c--;)a.files[c].id===b&&a.files.splice(c,1)}}]),angular.module("obiba.mica.access",["pascalprecht.translate","obiba.alert","obiba.comments","obiba.mica.attachment","obiba.utils","angularMoment","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaAccessTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({list:{header:null,footer:null},view:{header:null,footer:null},form:{header:null,footer:null}}))}]),angular.module("obiba.mica.access").controller("DataAccessRequestListController",["$rootScope","$scope","$uibModal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessRequestService","NOTIFICATION_EVENTS","SessionProxy","USER_ROLES","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a){for(var c=0;c<a.length;c++){var d=a[c];if("OPENED"!==d.status)for(var e=0;e<d.statusChangeHistory.length;e++){var f=d.statusChangeHistory[e];"OPENED"===f.from&&"SUBMITTED"===f.to&&(d.submissionDate=f.changedOn)}}b.requests=a,b.loading=!1},m=function(){b.loading=!1};f.getStatusFilterData(function(a){b.REQUEST_STATUS=a}),b.headerTemplateUrl=j.getHeaderUrl("list"),b.footerTemplateUrl=j.getFooterUrl("list"),b.config=k.getOptions(),b.searchStatus={},b.loading=!0,d.query({},l,m),b.actions=f.actions,b.showApplicant=h.roles().filter(function(a){return[i.dao,i.admin].indexOf(a)>-1}).length>0,b.deleteRequest=function(c){b.requestToDelete=c.id,a.$broadcast(g.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[c.title,c.applicant]},c.id)},b.userProfile=function(a){b.applicant=a,c.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})};var n=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};b.getFullName=function(a){return a?a.attributes?n(a.attributes,"firstName")+" "+n(a.attributes,"lastName"):a.username:null},b.getProfileEmail=function(a){return a&&a.attributes?n(a.attributes,"email"):null},b.$on(g.confirmDialogAccepted,function(a,c){b.requestToDelete===c&&(e["delete"]({id:b.requestToDelete},function(){b.loading=!0,d.query({},l,m)}),delete b.requestToDelete)})}]).controller("DataAccessRequestViewController",["$rootScope","$scope","$location","$uibModal","$routeParams","$filter","DataAccessRequestResource","DataAccessRequestService","DataAccessRequestStatusResource","DataAccessFormConfigResource","JsonUtils","DataAccessRequestCommentsResource","DataAccessRequestCommentResource","ngObibaMicaUrl","ngObibaMicaAccessTemplateUrl","AlertService","ServerErrorUtils","NOTIFICATION_EVENTS","DataAccessRequestConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=function(a){p.alert({id:"DataAccessRequestViewController",type:"danger",msg:q.buildMessage(a)})},u=function(){b.form.comments=l.query({id:e.id})},v=function(a){switch(b.selectedTab=a,a){case"form":break;case"comments":u()}},w=function(a){l.save({id:e.id},a.message,u,t)},x=function(a){m.update({id:e.id,commentId:a.id},a.message,u,t)},y=function(c){b.commentToDelete=c.id,a.$broadcast(r.showConfirmDialog,{titleKey:"comment.delete-dialog.title",messageKey:"comment.delete-dialog.message",messageArgs:[c.createdBy]},c.id)};b.form={schema:null,definition:null,model:{},comments:null},b.$on(r.confirmDialogAccepted,function(a,c){b.commentToDelete===c&&m["delete"]({id:e.id,commentId:c},{},u,t)}),b.getDownloadHref=function(a,c){return n.getUrl("DataAccessRequestAttachmentDownloadResource").replace(":id",b.dataAccessRequest.id).replace(":attachmentId",c)},b.config=s.getOptions(),b.actions=h.actions,b.nextStatus=h.nextStatus,b.selectTab=v,b.submitComment=w,b.updateComment=x,b.deleteComment=y,b.headerTemplateUrl=o.getHeaderUrl("view"),b.footerTemplateUrl=o.getFooterUrl("view"),b.getStatusHistoryInfoId=h.getStatusHistoryInfoId,h.getStatusHistoryInfo(function(a){b.getStatusHistoryInfo=a}),b.validForm=!0;var z=function(){return g.get({id:e.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{},b.requestDownloadUrl=n.getUrl("DataAccessRequestDownloadPdfResource").replace(":id",b.dataAccessRequest.id)}catch(c){b.validForm=!1,b.form.model={},p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.parse-error"})}return j.get(function(a){b.form.definition=k.parseJsonSafely(a.definition,[]),b.form.schema=k.parseJsonSafely(a.schema,{}),0===b.form.definition.length&&(b.validForm=!1,b.form.definition=[],p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.validForm=!1,b.form.schema={readonly:!0},p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.form.schema.readonly=!0,b.$broadcast("schemaFormRedraw")},t),a.attachments=a.attachments||[],a})};b.dataAccessRequest=e.id?z():{},b["delete"]=function(){b.requestToDelete=b.dataAccessRequest.id,a.$broadcast(r.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[b.dataAccessRequest.title,b.dataAccessRequest.applicant]},b.requestToDelete)},b.$on(r.confirmDialogAccepted,function(a,d){b.requestToDelete===d&&(g["delete"]({id:b.requestToDelete},function(){c.path("/data-access-requests").replace()}),delete b.requestToDelete)});var A=function(){b.dataAccessRequest=z()},B=function(b,c,d){a.$broadcast(r.showConfirmDialog,{titleKey:"data-access-request.status-change-confirmation.title",messageKey:null!==c?c:"data-access-request.status-change-confirmation.message",messageArgs:null!==d?[f("translate")(d).toLowerCase()]:[]},b)},C=function(a,c){a===c&&i.update({id:b.dataAccessRequest.id,status:a},A,t)};b.submit=function(){b.$broadcast("schemaFormValidate"),b.forms.requestForm.$valid?i.update({id:b.dataAccessRequest.id,status:h.status.SUBMITTED},function(){A(),d.open({scope:b,templateUrl:"access/views/data-access-request-submitted-modal.html"})},t):p.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},b.reopen=function(){B(h.status.OPENED,null,"reopen")},b.review=function(){B(h.status.REVIEWED,"data-access-request.status-change-confirmation.message-review",null)},b.approve=function(){B(h.status.APPROVED,null,"approve")},b.reject=function(){B(h.status.REJECTED,null,"reject")},b.userProfile=function(a){b.applicant=a,d.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})};var D=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};b.getFullName=function(a){return a?a.attributes?D(a.attributes,"firstName")+" "+D(a.attributes,"lastName"):a.username:null},b.getProfileEmail=function(a){return a&&a.attributes?D(a.attributes,"email"):null},b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.OPENED,b)}),b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.REVIEWED,b)}),b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.APPROVED,b)}),b.$on(r.confirmDialogAccepted,function(a,b){C(h.status.REJECTED,b)}),b.forms={}}]).controller("DataAccessRequestEditController",["$log","$scope","$routeParams","$location","$uibModal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessFormConfigResource","JsonUtils","AlertService","ServerErrorUtils","SessionProxy","DataAccessRequestService","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(a,b){var c=b().location.split("/");d.path("/data-access-request/"+c[c.length-1]).replace()},q=function(a){j.alert({id:"DataAccessRequestEditController",type:"danger",msg:k.buildMessage(a)})},r=function(){b.$broadcast("schemaFormValidate"),e.open({scope:b,templateUrl:"access/views/data-access-request-validation-modal.html"})},s=function(){d.path("/data-access-request"+(c.id?"/"+c.id:"s")).replace()},t=function(){b.dataAccessRequest.content=JSON.stringify(b.form.model),b.newRequest?f.save(b.dataAccessRequest,p,q):g.save(b.dataAccessRequest,function(){d.path("/data-access-request"+(b.dataAccessRequest.id?"/"+b.dataAccessRequest.id:"s")).replace()},q)};h.get(function(a){b.form.definition=i.parseJsonSafely(a.definition,[]),b.form.schema=i.parseJsonSafely(a.schema,{}),0===b.form.definition.length&&(b.form.definition=[],b.validForm=!1,j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.form.schema={},b.validForm=!1,j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.validForm&&(b.dataAccessRequest=c.id?g.get({id:c.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{}}catch(c){b.form.model={},j.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-request.parse-error"})}return b.canEdit=m.actions.canEdit(a),b.form.schema.readonly=!b.canEdit,b.$broadcast("schemaFormRedraw"),a.attachments=a.attachments||[],a}):{applicant:l.login(),status:m.status.OPENED,attachments:[]})},q),b.config=o.getOptions(),b.validForm=!0,b.requestId=c.id,b.newRequest=c.id?!1:!0,b.cancel=s,b.save=t,b.editable=!0,b.validate=r,b.headerTemplateUrl=n.getHeaderUrl("form"),b.footerTemplateUrl=n.getFooterUrl("form"),b.form={schema:null,definition:null,model:{}}}]),angular.module("obiba.mica.access").config(["$routeProvider",function(a){a.when("/data-access-requests",{templateUrl:"access/views/data-access-request-list.html",controller:"DataAccessRequestListController"}).when("/data-access-request/new",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id/edit",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id",{templateUrl:"access/views/data-access-request-view.html",controller:"DataAccessRequestViewController"})}]),angular.module("obiba.mica.access").factory("DataAccessFormConfigResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessRequestsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestsResource"),{},{save:{method:"POST",errorHandler:!0},get:{method:"GET"}})}]).factory("DataAccessRequestResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0},get:{method:"GET"},"delete":{method:"DELETE"}})}]).factory("DataAccessRequestCommentsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentsResource"),{},{save:{method:"POST",params:{id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0},get:{method:"GET",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentResource"),{},{"delete":{method:"DELETE",params:{id:"@id",commentId:"@commentId"},errorHandler:!0},update:{method:"PUT",params:{id:"@id",commentId:"@commentId"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("DataAccessRequestStatusResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestStatusResource"),{},{update:{method:"PUT",params:{id:"@id",status:"@status"},errorHandler:!0}})}]).service("DataAccessRequestConfig",function(){var a={newRequestButtonCaption:null,documentsSectionTitle:null,documentsSectionHelpText:null,downloadButtonCaption:null,commentsEnabled:!0,userListPageTitle:null};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("DataAccessRequestService",["$translate","SessionProxy",function(a,b){var c={OPENED:"OPENED",SUBMITTED:"SUBMITTED",REVIEWED:"REVIEWED",APPROVED:"APPROVED",REJECTED:"REJECTED"};this.status=c,this.getStatusFilterData=function(b){b&&a(Object.keys(c)).then(function(a){b(Object.keys(a).map(function(b){return a[b]}))})};var d=function(a,b){return a.actions?-1!==a.actions.indexOf(b):null};this.actions={canViewProfile:function(a){var c=!1,d=b.roles();return angular.forEach(d,function(b){b===a&&(c=!0)}),c},canView:function(a){return d(a,"VIEW")},canEdit:function(a){return d(a,"EDIT")},canEditStatus:function(a){return d(a,"EDIT_STATUS")},canDelete:function(a){return d(a,"DELETE")}};var e=function(a,b){return a.nextStatus?-1!==a.nextStatus.indexOf(b):null};return this.nextStatus={canSubmit:function(a){return e(a,"SUBMITTED")},canReopen:function(a){return e(a,"OPENED")},canReview:function(a){return e(a,"REVIEWED")},canApprove:function(a){return e(a,"APPROVED")},canReject:function(a){return e(a,"REJECTED")}},this.getStatusHistoryInfo=function(b){if(b){var c={"data-access-request.histories.opened":"opened","data-access-request.histories.reopened":"reopened","data-access-request.histories.submitted":"submitted","data-access-request.histories.reviewed":"reviewed","data-access-request.histories.approved":"approved","data-access-request.histories.rejected":"rejected"},d={opened:{id:"opened",icon:"glyphicon glyphicon-saved"},reopened:{id:"reopened",icon:"glyphicon glyphicon-repeat"},submitted:{id:"submitted",icon:"glyphicon glyphicon-export"},reviewed:{id:"reviewed",icon:"glyphicon glyphicon-check"},approved:{id:"approved",icon:"glyphicon glyphicon-ok"},rejected:{id:"rejected",icon:"glyphicon glyphicon-remove"}};a(Object.keys(c)).then(function(a){Object.keys(a).forEach(function(b){d[c[b]].msg=a[b]}),b(d)})}},this.getStatusHistoryInfoId=function(a){var b="opened";if("OPENED"!==a.from||a.from!==a.to)switch(a.to){case"OPENED":b="reopened";break;case"SUBMITTED":b="submitted";break;case"REVIEWED":b="reviewed";break;case"APPROVED":b="approved";break;case"REJECTED":b="rejected"}return b},this}]).filter("filterProfileAttributes",function(){return function(a){var b=["email","firstName","lastName","createdDate","lastLogin","username"];return a.filter(function(a){return-1===b.indexOf(a.key)})}}),angular.module("obiba.mica.search",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaSearchTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({list:{header:null,footer:null},view:{header:null,footer:null},form:{header:null,footer:null}}))}]);var QUERY_TYPES={NETWORKS:"networks",STUDIES:"studies",DATASETS:"datasets",VARIABLES:"variables"},QUERY_TARGETS={NETWORKS:"networks",STUDIES:"studies",DATASETS:"datasets",VARIABLES:"variables"};angular.module("obiba.mica.search").constant("QUERY_TYPES",QUERY_TYPES).constant("QUERY_TARGETS",QUERY_TARGETS).constant("DISPLAY_TYPES",{LIST:"list",COVERAGE:"coverage",GRAPHICS:"graphics"}).controller("SearchController",["$scope","$timeout","$routeParams","$location","TaxonomiesSearchResource","TaxonomiesResource","TaxonomyResource","VocabularyResource","ngObibaMicaSearchTemplateUrl","JoinQuerySearchResource","JoinQueryCoverageResource","QUERY_TYPES","DISPLAY_TYPES","AlertService","ServerErrorUtils","LocalizedValues","ObibaSearchConfig","RqlQueryService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a){n.alert({id:"SearchController",type:"danger",msg:o.buildMessage(a),delay:5e3})}function t(a){if(!a||!l[a.toUpperCase()])throw new Error("Invalid type: "+a)}function u(a){if(!a||!m[a.toUpperCase()])throw new Error("Invalid display: "+a)}function v(a){var b=":q(match())";switch(a){case l.NETWORKS:return b.replace(/:q/,"network");case l.STUDIES:return b.replace(/:q/,"study");case l.DATASETS:return b.replace(/:q/,"dataset");case l.VARIABLES:return b.replace(/:q/,"variable")}throw new Error("Invalid query type: "+a)}function w(){if(a.settingsDisplay.variables.showSearchTab)return l.VARIABLES;var b=Object.keys(a.settingsDisplay).filter(function(b){return 1===a.settingsDisplay[b].showSearchTab});return console.log(b),b[b.length-1]}function x(){try{var b=d.search(),c=b.type||w(),e=b.display||m.LIST,f=b.query||v(c);t(c),u(e),(new RqlParser).parse(f);var g=(new RqlParser).parse(f);return r.buildVariableCriteria(g,a.lang).then(function(a){a.forEach(function(a){G(a)})}),a.search.type=c,a.search.display=e,a.search.query=f,!0}catch(h){n.alert({id:"SearchController",type:"danger",msg:h.message,delay:5e3})}return!1}function y(){if(x())switch(a.search.result=null,a.search.display){case m.LIST:j[a.search.type]({query:a.search.query},function(b){a.search.result=b},s);break;case m.COVERAGE:k.get({query:r.prepareCoverageQuery(a.search.query,["studyIds"])},function(b){a.search.result=b},s);break;case m.GRAPHICS:}}a.settingsDisplay=q.getOptions();var z=function(){angular.element("#taxonomies").collapse("hide")},A=function(b){return a.taxonomies.search.active=!0,b&&1===b.length?void(a.taxonomies.search.active=!1):void(a.taxonomies.taxonomy?a.taxonomies.vocabulary?h.get({target:a.taxonomies.target,taxonomy:a.taxonomies.taxonomy.name,vocabulary:a.taxonomies.vocabulary.name,query:b},function(b){a.taxonomies.vocabulary.terms=b.terms,a.taxonomies.search.active=!1}):g.get({target:a.taxonomies.target,taxonomy:a.taxonomies.taxonomy.name,query:b},function(b){a.taxonomies.taxonomy.vocabularies=b.vocabularies,a.taxonomies.search.active=!1}):f.get({target:a.taxonomies.target,query:b},function(b){a.taxonomies.all=b,a.taxonomies.search.active=!1}))},B=function(b){a.taxonomiesShown||angular.element("#taxonomies").collapse("show"),a.taxonomies.target!==b&&(a.taxonomies.target=b,a.taxonomies.taxonomy=null,a.taxonomies.vocabulary=null,A(a.taxonomies.search.text))},C=function(){a.taxonomies.search.text=null,a.taxonomies.search.active=!1,A(null)},D=function(b){switch(b.keyCode){case 27:a.taxonomies.search.active||C();break;case 13:A(a.taxonomies.search.text)}},E=function(){a.documents.search.text=null,a.documents.search.active=!1},F=function(b){return e.get({query:b}).$promise.then(function(c){if(c){var d=[],e=0,f=10;if(c.forEach(function(b){var c=b.target,g=b.taxonomy;g.vocabularies&&g.vocabularies.forEach(function(b){b.terms?b.terms.forEach(function(h){d.length<f&&d.push(r.createCriteria(c,g,b,h,a.lang)),e++}):(d.length<f&&d.push(r.createCriteria(c,g,b,null,a.lang)),e++)})}),e>d.length){var g={query:b,total:e,size:f,message:"Showing "+f+" / "+e,status:"has-warning"};d.push(g)}return d}return[]})},G=function(b){if(console.log("selectCriteria",b),b.id){var c=a.search.criteria.filter(function(a){return b.vocabulary.name===a.vocabulary.name});console.log("Found",c),c&&0===c.length&&a.search.criteria.push(b),a.selectedCriteria=null}else a.selectedCriteria=b.query},H=function(b){switch(b.keyCode){case 27:a.documents.search.active&&E();break;default:a.documents.search.text&&F(a.documents.search.text)}},I=function(b,c){var d=a.taxonomies.taxonomy&&!b||a.taxonomies.vocabulary&&!c;a.taxonomies.taxonomy=b,a.taxonomies.vocabulary=c,d&&A(a.taxonomies.search.text)},J=function(b,c,d,e){G(r.createCriteria(b,c,d,e,a.lang))},K=function(a){if(a){t(a);var b=d.search();b.type=a,d.search(b).replace()}},L=function(a){if(a){u(a);var b=d.search();b.display=a,d.search(b).replace()}};a.QUERY_TYPES=l,a.lang="en",a.search={query:null,type:null,result:null,criteria:[]},a.documents={search:{text:null,active:!1}},a.taxonomies={all:f.get({target:"variable"}),search:{text:null,active:!1},target:"variable",taxonomy:null,vocabulary:null},a.headerTemplateUrl=i.getHeaderUrl("view"),a.clearFilterTaxonomies=C,a.searchCriteria=F,a.selectCriteria=G,a.searchKeyUp=H,a.filterTaxonomiesKeyUp=D,a.navigateTaxonomy=I,a.selectTaxonomyTarget=B,a.selectTerm=J,a.closeTaxonomies=z,a.onTypeChanged=K,a.onDisplayChanged=L,a.taxonomiesShown=!1,angular.element("#taxonomies").on("show.bs.collapse",function(){a.taxonomiesShown=!0}),angular.element("#taxonomies").on("hide.bs.collapse",function(){a.taxonomiesShown=!1}),a.$watch("search",function(){y()}),a.$on("$locationChangeSuccess",function(a,b){a!==b&&y()})}]).controller("SearchResultController",["$scope","QUERY_TYPES","DISPLAY_TYPES","ObibaSearchConfig",function(a,b,c,d){a.settingsDisplay=d.getOptions(),a.selectDisplay=function(b){console.log("Display",b),a.display=b,a.$parent.onDisplayChanged(b)},a.selectTarget=function(b){console.log("Target",b),a.type=b,a.$parent.onTypeChanged(b)},a.QUERY_TYPES=b,a.DISPLAY_TYPES=c,a.$watch("type",function(){a.activeTarget={networks:a.type===b.NETWORKS&&a.settingsDisplay.networks.showSearchTab||!1,studies:a.type===b.STUDIES&&a.settingsDisplay.studies.showSearchTab||!1,datasets:a.type===b.DATASETS&&a.settingsDisplay.datasets.showSearchTab||!1,variables:a.type===b.VARIABLES&&a.settingsDisplay.variables.showSearchTab||!1}}),a.$watch("display",function(){a.activeDisplay={list:a.display===c.LIST||!1,coverage:a.display===c.COVERAGE||!1,graphics:a.display===c.GRAPHICS||!1}})}]).controller("CriterionDropdownController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource",function(a,b,c,d){console.log("QueryDropdownController",a);var e=function(b){return-1!==a.selectedTerms.indexOf(b)},f=function(){a.selectedTerms=a.criterion.vocabulary.terms.map(function(a){return a.name})},g=function(b){return e(b.name)?void(a.selectedTerms=a.selectedTerms.filter(function(a){return a!==b.name})):void a.selectedTerms.push(b.name)},h=function(b){return c.forLocale(b,a.criterion.lang)},i=function(a){return a.length>40?a.substring(0,40)+"...":a},j=function(){if(a.open)return void(a.open=!1);var c=a.criterion.target,e=b.prepareCriteriaTermsQuery(c,a.query,a.criterion.taxonomy.name,a.criterion.vocabulary.name);d[targetToType(c)]({query:e}).$promise.then(function(b){console.log("GOT THE RESULT",b),a.open=!0})};a.selectedTerms=a.criterion.selectedTerms.map(function(a){return a.name}),a.isOpen=!1,a.openDropdown=j,a.selectAll=f,a.deselectAll=function(){a.selectedTerms=[]},a.toggleSelection=g,a.isSelected=e,a.localize=h,a.truncate=i}]).controller("CriteriaPanelController",["$scope",function(a){a.removeCriteria=function(b){a.criteria=a.criteria.filter(function(a){return b!==a.id})}}]).controller("CoverageResultTableController",["$scope",function(a){function b(){var b=a.result,c=[],d=[],e=[],f={},g={total:[]};if(b.taxonomies){var h=0;b.taxonomies.forEach(function(a){a.vocabularies&&(a.vocabularies.forEach(function(b){b.terms&&(b.terms.forEach(function(c){h++,e.push({taxonomy:a.taxonomy,vocabulary:b.vocabulary,term:c.term}),g.total.push(c.hits),c.buckets&&c.buckets.forEach(function(a){a.field in f||(f[a.field]={}),a.value in f[a.field]||(f[a.field][a.value]={field:a.field,title:a.title,description:a.description,hits:{}}),f[a.field][a.value].hits[h]=a.hits})}),d.push({taxonomy:a.taxonomy,vocabulary:b.vocabulary,termsCount:b.terms.length}))}),c.push({taxonomy:a.taxonomy,termsCount:h}))})}return Object.keys(f).forEach(function(a){Object.keys(f[a]).forEach(function(b){var c=f[a][b].hits;f[a][b].totalHits=Object.keys(c).map(function(a){return c[a]}).reduce(function(a,b){return a+b})})}),{taxonomyHeaders:c,vocabularyHeaders:d,termHeaders:e,rows:f,footers:g,totalHits:b.totalHits,totalCount:b.totalCount}}a.$watch("result",function(){a.result&&(a.table=b())})}]),angular.module("obiba.mica.search").directive("taxonomyPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomy:"=",lang:"=",onNavigate:"="},templateUrl:"search/views/taxonomy-panel-template.html"}}]).directive("vocabularyPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomy:"=",vocabulary:"=",lang:"=",onNavigate:"="},templateUrl:"search/views/vocabulary-panel-template.html"}}]).directive("termPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",term:"=",lang:"=",onSelect:"="},templateUrl:"search/views/term-panel-template.html"}}]).directive("networksResultTable",[function(){return{restrict:"EA",replace:!0,scope:{summaries:"="},templateUrl:"search/views/networks-search-result-table-template.html"}}]).directive("datasetsResultTable",[function(){return{restrict:"EA",replace:!0,scope:{summaries:"="},templateUrl:"search/views/datasets-search-result-table-template.html"}}]).directive("studiesResultTable",[function(){return{restrict:"EA",replace:!0,scope:{summaries:"="},templateUrl:"search/views/studies-search-result-table-template.html"}}]).directive("variablesResultTable",[function(){return{restrict:"EA",replace:!0,scope:{summaries:"="},templateUrl:"search/views/variables-search-result-table-template.html"}}]).directive("coverageResultTable",[function(){return{restrict:"EA",replace:!0,scope:{result:"="},controller:"CoverageResultTableController",templateUrl:"search/views/coverage-search-result-table-template.html"}}]).directive("resultPanel",[function(){return{restrict:"EA",replace:!0,scope:{type:"=",display:"=",dto:"=",lang:"=",onTypeChanged:"="},controller:"SearchResultController",templateUrl:"search/views/search-result-panel-template.html"
}}]).directive("criterionDropdown",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",onSelect:"=",onRemove:"="},controller:"CriterionDropdownController",templateUrl:"search/views/criterion-dropdown-template.html",link:function(a,b){a.remove=function(c){a.onRemove(c),b.remove(),a.$destroy()}}}}]).directive("criteriaPanel",[function(){return{restrict:"EA",replace:!0,scope:{criteria:"=",query:"="},controller:"CriteriaPanelController",templateUrl:"search/views/criteria-panel-template.html"}}]),angular.module("obiba.mica.search").config(["$routeProvider",function(a){a.when("/search",{templateUrl:"search/views/search.html",controller:"SearchController",reloadOnSearch:!1})}]);var FindNodeVisitor=function(a){this.node=null,this.name=a};FindNodeVisitor.prototype.accept=function(a){return this.name===a.name?(this.node=a,!0):!1},FindNodeVisitor.prototype.getNode=function(){return this.node},AbstractCriteriaBuilder.prototype.visitLeaf=function(){},AbstractCriteriaBuilder.prototype.getCriteriaList=function(){return this.criteriaList},AbstractCriteriaBuilder.prototype.visitCondition=function(a){this.visit(a.args[0]),this.visit(a.args[1])},AbstractCriteriaBuilder.prototype.visit=function(a){switch(console.log("Visit",a),a.name){case"and":case"or":this.visitCondition(a);break;case"in":case"out":case"eq":case"le":case"lt":case"ge":case"gt":case"between":this.visitLeaf(a);break;case"not":case"match":}},AbstractCriteriaBuilder.prototype.build=function(){var a=this;this.root.args.forEach(function(b){a.visit(b)})};var VariableCriteriaBuilder=function(a,b,c,d){AbstractCriteriaBuilder.call(this,a,b,c,d),this.target="variable",this.parserFieldName=function(a){var b=/(\w+)__(\w+)/,c=b.exec(a.replace(/attributes\./,"").replace(/\.\w+$/,""));if(c&&c.length>2)return{taxonomy:c[1],vocabulary:c[2]};throw new Error("Invalid field name",a)}};VariableCriteriaBuilder.prototype=Object.create(AbstractCriteriaBuilder.prototype),VariableCriteriaBuilder.prototype.visitLeaf=function(a){console.log("VariableCriteriaBuilder");var b=a.args[0],c=a.args[1],d=this.parserFieldName(b);console.log(a.name,"F:",b,"V:",c),this.addCriteria(d.taxonomy,d.vocabulary,c instanceof Array?c:[c])};var RqlQueryBuilder=function(a){this.rqlParser=a};RqlQueryBuilder.prototype.node=function(a,b,c){var d=":name(:f,(:args))".replace(/:name/,a).replace(/:f/,b).replace(/:args/,c.join(","));return this.rqlParser.parse(d).args[0]},angular.module("obiba.mica.search").factory("TaxonomiesSearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesSearchResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]).factory("TaxonomiesResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]).factory("TaxonomyResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomyResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("JoinQuerySearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQuerySearchResource"),{},{variables:{method:"GET",errorHandler:!0,params:{type:"variables"}},studies:{method:"GET",errorHandler:!0,params:{type:"studies"}},networks:{method:"GET",errorHandler:!0,params:{type:"networks"}},datasets:{method:"GET",errorHandler:!0,params:{type:"datasets"}}})}]).factory("JoinQueryCoverageResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQueryCoverageResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("VocabularyResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("VocabularyResource"),{},{get:{method:"GET",errorHandler:!0}})}]).service("ObibaSearchConfig",function(){var a={networks:{showSearchTab:1},studies:{showSearchTab:1},datasets:{showSearchTab:1},variables:{showSearchTab:1}};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("RqlQueryService",["$q","TaxonomiesResource","LocalizedValues",function(a,b,c){function d(a,b){if(console.log("findNode",a),a instanceof RqlQuery){if(b.accept(a))return!0;a.args&&a.args.some(function(a){return d(a,b)})}return!1}function e(a,b){var c=new FindNodeVisitor(b);return d(a,c),c.getNode()}var f=null;this.createCriteria=function(a,b,d,e,f){return new CriteriaItemBuilder(c,f).target(a).taxonomy(b).vocabulary(d).term(e).build()},this.variableNode=function(a){return e(a,"variable")},this.buildVariableCriteria=function(d,e){function g(){var a=h.variableNode(d);if(a){var b=new VariableCriteriaBuilder(a,h.variableTaxonomies,c,e);b.build(),i.resolve(b.getCriteriaList())}}var h=this,i=a.defer();return f?g():b.get({target:"variable"}).$promise.then(function(a){h.variableTaxonomies=a,g()}),i.promise},this.normalizeAggregationFieldName=function(a,b,c){switch(a){case"variable":return"attributes."+b+"__"+c+".und"}throw new Error("Not implemented: "+b+" "+c)},this.prepareCriteriaTermsQuery=function(a,b,c,d){var e=(new RqlParser).parse(b),f=new RqlQuery("aggregate"),g=new RqlQuery("facet");return f.args.push(this.normalizeAggregationFieldName(a,c,d)),e.args.some(function(b){return b.name===a?(b.args.push(f),!0):!1}),e.args.push(g),e.serializeArgs(e.args)},this.prepareCoverageQuery=function(a,b){var c=(new RqlParser).parse(a),d=new RqlQuery("aggregate"),e=new RqlQuery("bucket");return b.forEach(function(a){e.args.push(a)}),d.args.push(e),c.args.forEach(function(a){"variable"===a.name&&a.args.push(d)}),c.serializeArgs(c.args)}}]),angular.module("obiba.mica.graphics",["googlechart","obiba.utils","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("GraphicChartsData",GraphicChartsDataProvider)}]),angular.module("obiba.mica.graphics").directive("obibaChart",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"@",chartType:"@",chartAggregationName:"@",chartEntityDto:"@",chartOptionsName:"@",chartOptions:"=",chartHeader:"="},templateUrl:"graphics/views/charts-directive.html",controller:"GraphicChartsController"}}]),angular.module("obiba.mica.graphics").controller("GraphicChartsController",["$rootScope","$scope","$filter","GraphicChartsConfig","GraphicChartsUtils","GraphicChartsData",function(a,b,c,d,e,f){f.getData(function(a){a&&(b.ItemDataJSon=e.getArrayByAggregation(b.chartAggregationName,a[b.chartEntityDto],b.fieldTransformer),b.ItemDataJSon.unshift(b.chartHeader),b.ItemDataJSon&&(b.chartObject={},b.chartObject.type=b.chartType,b.chartObject.data=b.ItemDataJSon,b.chartObject.options={backgroundColor:{fill:"transparent"}},angular.extend(b.chartObject.options,b.chartOptions),b.chartObject.options.title=b.chartOptions.title+" (N="+a.studyResultDto.totalHits+")"))})}]),angular.module("obiba.mica.graphics").factory("GraphicChartsDataResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("PublishedStudiesSearchResource"),{},{get:{method:"POST",errorHandler:!0}})}]).service("GraphicChartsConfig",function(){var a={options:{entityIds:"NaN",entityType:null}};return a.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a.options&&(a.options[c]=b[c])})},a.getOptions=function(){return angular.copy(a.options)},a}).service("GraphicChartsUtils",["CountriesIsoUtils","LocalizedStringService",function(a,b){this.getArrayByAggregation=function(c,d,e){var f=[];return angular.forEach(d.aggs,function(d){var g=[];if(d.aggregation===c){var h=0;angular.forEach(d["obiba.mica.TermsAggregationResultDto.terms"],function(c){switch(e){case"country":g.name=a.findByCode(c.title.toUpperCase(),b.getLocal());break;default:g.name=c.title}c.count&&(f[h]=[g.name,c.count],h++)})}}),f}}]).service("GraphicChartsQuery",[function(){this.queryDtoBuilder=function(a){return a&&"NaN"!==a?'{"studyQueryDto":{"from":0,"size":0,"sort":{"field":"acronym.en","order":0}},"networkQueryDto":{"from":0,"size":0,"sort":{"field":"acronym.en","order":0},"filteredQuery":{"obiba.mica.LogicalFilterQueryDto.filter":{"fields":[{"field":{"field":"id","obiba.mica.TermsFilterQueryDto.terms":{"values":["'+a+'"]}},"op":1}]}}},"locale":"en","withFacets":true}':'{"studyQueryDto":{"from":0,"size":0,"sort":{"field":"acronym.en","order":0}},"locale":"en","withFacets":true}'}}]),angular.module("obiba.mica.localized",["obiba.notification","pascalprecht.translate","templates-ngObibaMica"]),angular.module("obiba.mica.localized").directive("localized",[function(){return{restrict:"AE",scope:{value:"=",lang:"="},template:'<span ng-repeat="localizedValue in value | filter:{lang:lang}">{{localizedValue.value}}</span>'}}]).directive("localizedInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@"},templateUrl:"localized/localized-input-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]);var c=a.model.filter(function(b){return b.lang===a.lang?b:void 0});0===c.length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedInputGroup",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",remove:"="},templateUrl:"localized/localized-input-group-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]);var c=a.model.filter(function(b){return b.lang===a.lang?b:void 0});0===c.length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedTextarea",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",rows:"@"},templateUrl:"localized/localized-textarea-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]);var c=a.model.filter(function(b){return b.lang===a.lang?b:void 0});0===c.length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]),angular.module("obiba.mica.localized").service("LocalizedValues",function(){this["for"]=function(a,b,c,d){if(angular.isArray(a)){var e=a.filter(function(a){return a[c]===b});return e&&e.length>0?e[0][d]:a}},this.forLocale=function(a,b){return this["for"](a,b,"locale","text")},this.forLang=function(a,b){return this["for"](a,b,"lang","value")}}),angular.module("templates-ngObibaMica",["access/views/data-access-request-form.html","access/views/data-access-request-histroy-view.html","access/views/data-access-request-list.html","access/views/data-access-request-profile-user-modal.html","access/views/data-access-request-submitted-modal.html","access/views/data-access-request-validation-modal.html","access/views/data-access-request-view.html","attachment/attachment-input-template.html","attachment/attachment-list-template.html","graphics/views/charts-directive.html","localized/localized-input-group-template.html","localized/localized-input-template.html","localized/localized-textarea-template.html","search/views/coverage-search-result-table-template.html","search/views/criteria-panel-template.html","search/views/criterion-dropdown-template.html","search/views/datasets-search-result-table-template.html","search/views/networks-search-result-table-template.html","search/views/search-result-panel-template.html","search/views/search.html","search/views/studies-search-result-table-template.html","search/views/taxonomies-view.html","search/views/taxonomy-panel-template.html","search/views/taxonomy-template.html","search/views/term-panel-template.html","search/views/variables-search-result-table-template.html","search/views/vocabulary-panel-template.html"]),angular.module("access/views/data-access-request-form.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-form.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestEditController"></obiba-alert>\n\n  <div ng-if="validForm">\n\n    <div class="pull-right">\n      <a ng-click="cancel()" type="button" class="btn btn-default">\n        <span translate>cancel</span>\n      </a>\n\n      <a ng-click="save()" type="button" class="btn btn-primary">\n        <span translate>save</span>\n      </a>\n\n      <a ng-click="validate()" type="button" class="btn btn-info">\n        <span translate>validate</span>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <form name="form.requestForm" ng-submit="submit(form.requestForm)">\n      <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema" required="true"></div>\n      <h2>{{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}</h2>\n      <p>{{config.documentsSectionHelpText || \'data-access-request.documents-help\' | translate}}</p>\n      <div class="form-group">\n        <attachment-input files="dataAccessRequest.attachments" multiple="true"></attachment-input>\n      </div>\n    </form>\n  </div>\n\n</div>\n')}]),angular.module("access/views/data-access-request-histroy-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-histroy-view.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<table id="data-access-request-history" class="table table-striped">\n  <thead>\n  <tr>\n    <th class="status-icon"></th>\n    <th translate>status</th>\n    <th translate>changed-by</th>\n    <th translate>Changed On</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="status in dataAccessRequest.statusChangeHistory"\n    ng-init="info = getStatusHistoryInfo[getStatusHistoryInfoId(status)]">\n    <td><span><i class="{{info.icon}} hoffset"></i></span></td>\n    <td>{{info.msg}}</span></span></td>\n    <td>{{userProfileService.getFullName(status.profile) || status.author}}</td>\n    <td><span>{{status.changedOn | fromNow}}</span></td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("access/views/data-access-request-list.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-list.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div id="data-access-request-list">\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <a ng-href="#/data-access-request/new" class="btn btn-info">\n    <i class="fa fa-plus"></i> <span>{{config.newRequestButtonCaption || \'data-access-request.add\' | translate}}</span>\n  </a>\n\n  <p class="help-block" ng-if="requests.length == 0 && !loading">\n    <span translate>data-access-request.none</span>\n  </p>\n\n  <p ng-if="loading" class="voffset2 loading">\n  </p>\n\n  <div ng-if="requests.length > 0">\n    <div class="row voffset2">\n      <div class="col-xs-4">\n        <span class="input-group input-group-sm no-padding-top">\n          <span class="input-group-addon" id="data-access-requests-search"><i\n              class="glyphicon glyphicon-search"></i></span>\n          <input ng-model="searchText" type="text" class="form-control"\n              aria-describedby="data-access-requests-search">\n        </span>\n      </div>\n      <div class="col-xs-2">\n        <div class="input-group">\n          <ui-select id="status-select" theme="bootstrap"\n              ng-model="searchStatus.filter" reset-search-input="true">\n            <ui-select-match allow-clear="true"\n                placeholder="{{\'data-access-request.status-placeholder\' | translate}}">\n              <span ng-bind-html="$select.selected"></span>\n            </ui-select-match>\n            <ui-select-choices repeat="data in REQUEST_STATUS">\n              {{data}}\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n      <div class="col-xs-6">\n        <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n      </div>\n    </div>\n\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th>ID</th>\n          <th translate ng-if="showApplicant">data-access-request.applicant</th>\n          <th translate>data-access-request.title</th>\n          <th translate>data-access-request.lastUpdate</th>\n          <th translate>data-access-request.submissionDate</th>\n          <th translate>data-access-request.status</th>\n          <th translate>actions</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr\n            dir-paginate="request in requests | filter:{status: searchStatus.filter} | filter:searchText | itemsPerPage: 20">\n          <td>\n            <a ng-href="#/data-access-request/{{request.id}}"\n                ng-if="actions.canView(request)" translate>{{request.id}}</a>\n            <span ng-if="!actions.canView(request)">{{request.id}}</span>\n          </td>\n          <td ng-if="showApplicant">\n            <span ng-if="actions.canViewProfile(\'mica-user\')">\n         {{getFullName(request.profile) || request.applicant}}\n            </span>\n            <a href ng-click="userProfile(request.profile)"\n                ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n              {{getFullName(request.profile) ||\n              request.applicant}}\n            </a>\n          </td>\n          <td>\n            {{request.title}}\n          </td>\n          <td>\n            {{(request.timestamps.lastUpdate || request.timestamps.created) |\n            fromNow}}\n          </td>\n          <td>\n            <span ng-if="request.submissionDate">{{request.submissionDate | fromNow}}</span>\n          </td>\n          <td>\n            {{request.status | translate}}\n          </td>\n          <td>\n            <ul class="list-inline">\n              <li ng-if="actions.canEdit(request)">\n                <a ng-href="#/data-access-request/{{request.id}}/edit"\n                    title="{{\'edit\' | translate}}"><i class="fa fa-pencil"></i></a>\n              </li>\n              <li>\n                <a ng-if="actions.canDelete(request)"\n                    ng-click="deleteRequest(request)"\n                    title="{{\'delete\' | translate}}"><i\n                    class="fa fa-trash-o"></i></a>\n              </li>\n            </ul>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n\n</div>\n')}]),angular.module("access/views/data-access-request-profile-user-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-profile-user-modal.html",'<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true"\n      ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <div>\n      <label class="control-label">\n        {{\'data-access-request.profile.name\' | translate}}\n      </label> :\n      <span>\n        {{getFullName(applicant)}}\n      </span>\n    </div>\n\n    <div>\n      <label class="control-label">\n        {{\'data-access-request.profile.email\' | translate}}\n      </label> :\n      <span>\n        {{getProfileEmail(applicant)}}\n      </span>\n    </div>\n\n    <div\n      ng-repeat="attribute in applicant.attributes | filterProfileAttributes">\n      <label  class="control-label">\n        {{attribute.key}}\n      </label> :\n      <span >{{attribute.value}}</span>\n    </div>\n    <a  class="btn btn-default" href="mailto:{{getProfileEmail(applicant)}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4"\n      ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-submitted-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-submitted-modal.html",'<?php\n/**\n * @file\n * Code for the obiba_mica_data_access_request modules.\n */\n\n?>\n<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.submit-confirmation.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p>{{\'data-access-request.submit-confirmation.message\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-validation-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-validation-modal.html",'<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 ng-if="form.requestForm.$valid" class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.validation.title-success\' | translate}}\n    </h4>\n    <h4 ng-if="!form.requestForm.$valid" class="modal-title">\n      <i class="fa fa-times fa-lg"></i>\n      {{\'data-access-request.validation.title-error\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p ng-if="form.requestForm.$valid">{{\'data-access-request.validation.success\' | translate}}</p>\n    <p ng-if="!form.requestForm.$valid" translate>{{\'data-access-request.validation.error\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-view.html",'<!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestViewController"></obiba-alert>\n\n  <div ng-if="validForm">\n\n    <p class="help-block pull-left"><span translate>created-by</span>\n       <span ng-if="actions.canViewProfile(\'mica-user\')">\n         {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}\n      </span>\n      <a href ng-click="userProfile(dataAccessRequest.profile)"\n          ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n        {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}\n      </a>,\n      <span>{{dataAccessRequest.timestamps.created | amCalendar}}</span>\n      <span class="label label-success">{{dataAccessRequest.status}}</span></p>\n\n    <div class="pull-right">\n      <a ng-click="submit()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canSubmit(dataAccessRequest)"\n        class="btn btn-info" translate>submit\n      </a>\n      <a ng-click="reopen()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReopen(dataAccessRequest)"\n        class="btn btn-info" translate>reopen\n      </a>\n      <a ng-click="review()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReview(dataAccessRequest)"\n        class="btn btn-info" translate>review\n      </a>\n      <a ng-click="approve()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canApprove(dataAccessRequest)"\n        class="btn btn-info" translate>approve\n      </a>\n      <a ng-click="reject()"\n        ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReject(dataAccessRequest)"\n        class="btn btn-info" translate>reject\n      </a>\n      <a ng-href="#/data-access-request/{{dataAccessRequest.id}}/edit"\n        ng-if="actions.canEdit(dataAccessRequest)"\n        class="btn btn-primary" title="{{\'edit\' | translate}}">\n        <i class="fa fa-pencil-square-o"></i>\n      </a>\n      <a target="_self" href="{{requestDownloadUrl}}" class="btn btn-default">\n        <i class="glyphicon glyphicon-download-alt"></i> <span>{{config.downloadButtonCaption || \'download\' | translate}}</span>\n      </a>\n      <a ng-click="delete()"\n        ng-if="actions.canDelete(dataAccessRequest)"\n        class="btn btn-danger" title="{{\'delete\' | translate}}">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <uib-tabset class="voffset5">\n      <uib-tab ng-click="selectTab(\'form\')" heading="{{\'data-access-request.form\' | translate}}">\n        <form id="request-form" name="forms.requestForm">\n          <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema"></div>\n        </form>\n        <h2>{{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}</h2>\n\n        <p ng-if="dataAccessRequest.attachments.length == 0" translate>\n          data-access-request.no-documents\n        </p>\n\n        <attachment-list files="dataAccessRequest.attachments"\n            href-builder="getDownloadHref(attachments, id)"></attachment-list>\n      </uib-tab>\n      <uib-tab ng-if="config.commentsEnabled" ng-click="selectTab(\'comments\')" heading="{{\'data-access-request.comments\' | translate}}">\n        <obiba-comments comments="form.comments" on-update="updateComment" on-delete="deleteComment" name-resolver="userProfileService.getFullName" edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n        <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n      </uib-tab>\n      <uib-tab ng-click="selectTab(\'history\')" heading="{{\'data-access-request.history\' | translate}}">\n        <div ng-include="\'access/views/data-access-request-histroy-view.html\'"></div>\n      </uib-tab>\n    </uib-tabset>\n  </div>\n\n</div>\n')}]),angular.module("attachment/attachment-input-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-input-template.html",'<button type="button" class="btn btn-primary btn-xs" aria-hidden="true" ngf-select ngf-change="onFileSelect($files)" translate>file.upload.button</button>\n\n<table ng-show="files.length" class="table table-striped">\n  <tbody>\n  <tr ng-repeat="file in files">\n    <td>\n      {{file.fileName}}\n      <uib-progressbar ng-show="file.showProgressBar" class="progress-striped" value="file.progress">\n        {{file.progress}}%\n      </uib-progressbar>\n    </td>\n    <td>\n      {{file.size | bytes}}\n    </td>\n    <td>\n      <a ng-show="file.id" ng-click="deleteFile(file.id)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n      <a ng-show="file.tempId" ng-click="deleteTempFile(file.tempId)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("attachment/attachment-list-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-list-template.html",'<table class="table table-bordered table-striped" ng-show="attachments.length">\n  <tbody>\n  <tr ng-repeat="attachment in attachments">\n    <th>\n      <a target="_self" ng-href="{{attachment.href}}"\n        download="{{attachment.fileName}}">{{attachment.fileName}}\n      </a>\n    </th>\n    <td>\n      {{attachment.size | bytes}}\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("graphics/views/charts-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/charts-directive.html",'<div>\n  <div google-chart chart="chartObject">\n  </div>\n</div>\n')}]),angular.module("localized/localized-input-group-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-group-template.html",'<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <div class="input-group">\n    <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <span class="input-group-btn" ng-show="remove">\n    <button class="btn btn-default" type="button" ng-click="remove(model)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n  </span>\n  </div>\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="error in form[fieldName].errors">{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-input-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-template.html",'<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="error in form[fieldName].errors">{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-textarea-template.html",[]).run(["$templateCache",function(a){
a.put("localized/localized-textarea-template.html",'<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <textarea ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" rows="{{rows ? rows : 5}}" class="form-control" id="{{fieldName}}" name="{{fieldName}}" form-server-error ng-disabled="disabled" ng-required="required"></textarea>\n\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="error in form[fieldName].errors">{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>')}]),angular.module("search/views/coverage-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/coverage-search-result-table-template.html",'<div>\n  <p class="help-block" ng-if="table.taxonomyHeaders.length === 0" translate>no-coverage</p>\n\n  <div class="table-responsive" ng-if="table.taxonomyHeaders.length > 0">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th rowspan="2" translate>study.label</th>\n        <th ng-repeat="header in table.vocabularyHeaders" title="{{header.vocabulary.descriptions[0].value}}"\n          colspan="{{header.termsCount}}">\n          {{header.vocabulary.titles[0].value}}\n        </th>\n        <th rowspan="2" translate>all</th>\n      </tr>\n      <tr>\n        <th ng-repeat="header in table.termHeaders" title="{{header.term.descriptions[0].value}}">\n          {{header.term.titles[0].value}}\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n\n      <tr ng-repeat="row in table.rows.studyIds">\n        <td title="{{row.description}}">{{row.title}}</td>\n        <td ng-repeat="h in table.termHeaders">\n          <span class="label label-info" ng-if="row.hits[$index + 1]">{{row.hits[$index + 1]}}</span>\n          <span ng-if="!row.hits[$index + 1]">0</span>\n        </td>\n        <th>\n          <a>{{row.totalHits}}</a>\n        </th>\n      </tr>\n\n      </tbody>\n      <tfoot>\n      <tr>\n        <th translate>all</th>\n        <th ng-repeat="hit in table.footers.total">\n          <a>{{hit}}</a>\n        </th>\n        <th>\n          <a>{{table.totalHits}}</a>\n        </th>\n      </tr>\n      </tfoot>\n    </table>\n  </div>\n\n      <!--<pre>-->\n<!--{{table | json}}-->\n      <!--</pre>-->\n</div>')}]),angular.module("search/views/criteria-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria-panel-template.html",'<span class="voffset4">\n  <span criterion-dropdown\n        ng-repeat="criterion in criteria"\n        criterion="criterion"\n        query="query"\n        on-select="selectTerm"\n        on-remove="removeCriteria"\n        class="{{$first ? \'\' : \'hoffset2\'}}">\n\n  </span>\n</span>\n')}]),angular.module("search/views/criterion-dropdown-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criterion-dropdown-template.html","<span class='btn-group btn-info' ng-class='{open: open}'>\n  <button class='btn btn-small btn-info dropdown'\n          ng-click='openDropdown()' title=\"{{localize(criterion.vocabulary.title)}}\">\n    {{truncate(localize(criterion.vocabulary.title))}}\n    <span class='fa fa-caret-down'></span>\n  </button>\n\n  <button class='btn btn-small btn-danger' ng-click='remove(criterion.id)'>\n    <span class='fa fa-times'></span>\n  </button>\n\n  <ul class='dropdown-menu query-dropdown-menu' aria-labelledby='dropdownMenu'>\n    <li>\n      <a ng-click='selectAll()'><i class='fa fa-check'></i> Check All</a>\n    </li>\n    <li>\n      <a ng-click='deselectAll();'><i class='fa fa-times'></i> Uncheck All</a>\n    </li>\n    <li class='divider'></li>\n    <li ng-repeat='term in criterion.vocabulary.terms'>\n      <a href ng-click='toggleSelection(term)' title=\"{{localize(term.title)}}\">\n        {{truncate(localize(term.title))}} <span ng-show=\"isSelected(term.name)\"\n                                                     class=\"fa fa-check pull-right\"></span>\n      </a>\n    </li>\n  </ul>\n</span>")}]),angular.module("search/views/datasets-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/datasets-search-result-table-template.html",'<div ng-show="summaries.length > 0">\n  <div class="row voffset2">\n    <div class="col-xs-4">\n    </div>\n    <div class="col-xs-8">\n      <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n    </div>\n  </div>\n\n  <div class="table-responsive">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th translate>acronym</th>\n        <th translate>name</th>\n        <th translate>type</th>\n        <th translate>networks</th>\n        <th translate>studies</th>\n        <th translate>variables</th>\n      </tr>\n      </thead>\n      <tbody>\n\n      <tr ng-repeat="summary in summaries">\n        <td>\n          <localized value="summary.acronym" lang="lang"></localized>\n        </td>\n        <td>\n          <localized value="summary.name" lang="lang"></localized>\n        </td>\n        <td>\n          <localized value="summary.type" lang="lang"></localized>\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].variables}}\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("search/views/networks-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/networks-search-result-table-template.html",'<div ng-show="summaries.length > 0">\n\n  <div class="row voffset2">\n    <div class="col-xs-4">\n    </div>\n    <div class="col-xs-8">\n      <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n    </div>\n  </div>\n\n  <div class="table-responsive">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th translate>acronym</th>\n        <th translate>name</th>\n        <th translate>studies</th>\n        <th translate colspan="2">datasets</th>\n        <th translate>variables</th>\n      </tr>\n      <tr>\n        <th></th>\n        <th></th>\n        <th></th>\n        <th translate>study</th>\n        <th translate>harmonization</th>\n        <th></th>\n      </tr>\n      </thead>\n      <tbody>\n\n      <tr ng-repeat="summary in summaries">\n        <td>\n          <localized value="summary.acronym" lang="lang"></localized>\n        </td>\n        <td>\n          <localized value="summary.name" lang="lang"></localized>\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables}}\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("search/views/search-result-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-panel-template.html",'<div>\n\n  <uib-tabset class="voffset2" type="tabs">\n\n    <uib-tab heading="{{\'list\' | translate}}" active="activeDisplay.list" ng-click="selectDisplay(DISPLAY_TYPES.LIST)">\n\n      <uib-tabset class="voffset2" type="pills">\n\n        <!-- Variables -->\n        <uib-tab ng-show="settingsDisplay.variables.showSearchTab" active="activeTarget.variables" ng-click="selectTarget(QUERY_TYPES.VARIABLES)"\n          heading="{{\'variables\' | translate}} ({{dto.variableResultDto.totalHits}})">\n          <variables-result-table\n            summaries="dto.variableResultDto[\'obiba.mica.DatasetVariableResultDto.result\'].summaries"></variables-result-table>\n        </uib-tab>\n\n        <!-- Datasets -->\n        <uib-tab ng-show="settingsDisplay.datasets.showSearchTab" active="activeTarget.datasets" ng-click="selectTarget(QUERY_TYPES.DATASETS)"\n          heading="{{\'datasets\' | translate}} ({{dto.datasetResultDto.totalHits}})">\n          <datasets-result-table\n            summaries="dto.datasetResultDto[\'obiba.mica.DatasetResultDto.result\'].datasets"></datasets-result-table>\n        </uib-tab>\n\n        <!-- Studies -->\n        <uib-tab ng-show="settingsDisplay.studies.showSearchTab" active="activeTarget.studies" ng-click="selectTarget(QUERY_TYPES.STUDIES)"\n          heading="{{\'studies\' | translate}} ({{dto.studyResultDto.totalHits}})">\n          <studies-result-table\n            summaries="dto.studyResultDto[\'obiba.mica.StudyResultDto.result\'].summaries"></studies-result-table>\n        </uib-tab>\n\n        <!-- Networks -->\n        <uib-tab ng-show="settingsDisplay.networks.showSearchTab" active="activeTarget.networks" ng-click="selectTarget(QUERY_TYPES.NETWORKS)"\n          heading="{{\'networks\' | translate}} ({{dto.networkResultDto.totalHits}})">\n          <networks-result-table\n            summaries="dto.networkResultDto[\'obiba.mica.NetworkResultDto.result\'].networks"></networks-result-table>\n        </uib-tab>\n      </uib-tabset>\n\n    </uib-tab>\n\n    <uib-tab heading="{{\'coverage\' | translate}}" active="activeDisplay.coverage"\n      ng-click="selectDisplay(DISPLAY_TYPES.COVERAGE)">\n      <coverage-result-table result="dto"  class="voffset2"></coverage-result-table>\n\n    </uib-tab>\n\n    <uib-tab heading="{{\'graphics\' | translate}}" active="activeDisplay.graphics"\n      ng-click="selectDisplay(DISPLAY_TYPES.GRAPHICS)">\n      <pre class="voffset2">\n{{dto | json}}\n      </pre>\n    </uib-tab>\n\n  </uib-tabset>\n\n</div>')}]),angular.module("search/views/search.html",[]).run(["$templateCache",function(a){a.put("search/views/search.html",'<div>\n  <!--<h2 translate>search</h2>-->\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="SearchController"></obiba-alert>\n\n  <!-- Classifications region -->\n  <div>\n    <!--<div>-->\n    <div class="row">\n      <div class="col-xs-3"></div>\n      <div class="col-xs-6">\n        <script type="text/ng-template" id="customTemplate.html">\n          <a ng-if="match.model.id">\n            <span title="{{match.model.target + \'-classifications\' | translate}}">\n              <i class="{{\'i-obiba-\' + match.model.target}}"></i>\n            </span>\n            <span title="{{match.model.itemDescription}}">{{match.model.itemTitle}}</span>\n            <small class="help-block no-margin hoffset3" title="{{match.model.itemParentDescription}}">\n              {{match.model.itemParentTitle}}\n            </small>\n          </a>\n          <a ng-if="!match.model.id" class="{{match.model.status}}">\n            <small class="help-block no-margin">\n              {{match.model.message}}\n            </small>\n          </a>\n        </script>\n        <a href>\n        <span class="input-group input-group-sm no-padding-top">\n          <input type="text" ng-model="selectedCriteria" placeholder="Search for criteria"\n            uib-typeahead="criteria for criteria in searchCriteria($viewValue)"\n            typeahead-min-length="2"\n            typeahead-loading="documents.search.active"\n            typeahead-template-url="customTemplate.html"\n            typeahead-on-select="selectCriteria($item)"\n            class="form-control">\n          <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>\n        </span>\n        </a>\n      </div>\n    </div>\n    <div class="row">\n      <div class="col-xs-3"></div>\n      <div class="col-xs-6">\n        <ul class="nav nav-pills">\n          <li ng-show="settingsDisplay.variables.showSearchTab" ng-class="{\'active\': taxonomies.target === \'variable\' && taxonomiesShown}"\n            title="{{\'variable-classifications\' | translate}}">\n            <a ng-click="selectTaxonomyTarget(\'variable\')" translate>variables</a>\n          </li>\n          <li ng-show="settingsDisplay.datasets.showSearchTab" ng-class="{\'active\': taxonomies.target === \'dataset\' && taxonomiesShown}"\n            title="{{\'dataset-classifications\' | translate}}">\n            <a ng-click="selectTaxonomyTarget(\'dataset\')" translate>datasets</a>\n          </li>\n          <li ng-show="settingsDisplay.studies.showSearchTab" ng-class="{\'active\': taxonomies.target === \'study\' && taxonomiesShown}"\n            title="{{\'study-classifications\' | translate}}">\n            <a ng-click="selectTaxonomyTarget(\'study\')" translate>studies</a>\n          </li>\n          <li ng-show="settingsDisplay.networks.showSearchTab" ng-class="{\'active\': taxonomies.target === \'network\' && taxonomiesShown}"\n            title="{{\'network-classifications\' | translate}}">\n            <a ng-click="selectTaxonomyTarget(\'network\')" translate>networks</a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div id="taxonomies" class="collapse">\n      <div ng-include="\'search/views/taxonomies-view.html\'"></div>\n    </div>\n  </div>\n\n  <!-- Search criteria region -->\n  <div class="voffset4">\n    <div class="row voffset4">\n      <div class="col-xs-12">\n        <div criteria-panel criteria="search.criteria" query="search.query"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Results region -->\n  <div>\n    <result-panel display="search.display" type="search.type" dto="search.result" on-type-changed="onTypeChanged"></result-panel>\n  </div>\n</div>')}]),angular.module("search/views/studies-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/studies-search-result-table-template.html",'<div ng-show="summaries.length > 0">\n\n  <div class="row voffset2">\n    <div class="col-xs-4">\n    </div>\n    <div class="col-xs-8">\n      <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n    </div>\n  </div>\n\n  <div class="table-responsive">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th translate>acronym</th>\n        <th translate>name</th>\n        <th translate>design</th>\n        <th translate>participants</th>\n        <th translate>networks</th>\n        <th translate colspan="2">datasets</th>\n        <th translate>variables</th>\n      </tr>\n      <tr>\n        <th></th>\n        <th></th>\n        <th></th>\n        <th></th>\n        <th></th>\n        <th translate>study</th>\n        <th translate>harmonization</th>\n        <th></th>\n      </tr>\n      </thead>\n      <tbody>\n\n      <tr ng-repeat="summary in summaries">\n        <td>\n          <localized value="summary.acronym" lang="lang"></localized>\n        </td>\n        <td>\n          <localized value="summary.name" lang="lang"></localized>\n        </td>\n        <td>\n          {{summary.designs.join(\', \')}}\n        </td>\n        <td>\n          {{summary.targetNumber.number}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets}}\n        </td>\n        <td>\n          {{summary[\'obiba.mica.CountStatsDto.studyCountStats\'].variables}}\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("search/views/taxonomies-view.html",[]).run(["$templateCache",function(a){a.put("search/views/taxonomies-view.html",'<div class="panel panel-default">\n  <div class="panel-heading">\n    <div class="row">\n      <div class="col-xs-8 voffset1">\n        <ol class="mica-breadcrumb no-margin no-padding">\n          <li ng-if="!taxonomies.taxonomy">\n            {{\'all-\' + taxonomies.target + \'-classifications\' | translate}}\n          </li>\n          <li ng-if="taxonomies.taxonomy">\n            <a href ng-click="navigateTaxonomy()">{{\'all-\' + taxonomies.target + \'-classifications\' | translate}}</a>\n          </li>\n          <li ng-if="taxonomies.taxonomy && !taxonomies.vocabulary">\n            <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n              {{label.text}}\n            </span>\n          </li>\n          <li ng-if="taxonomies.taxonomy && taxonomies.vocabulary">\n            <a href ng-click="navigateTaxonomy(taxonomies.taxonomy)">\n              <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n              {{label.text}}\n              </span>\n            </a>\n          </li>\n          <li ng-if="taxonomies.vocabulary">\n            <span ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n              {{label.text}}\n            </span>\n          </li>\n        </ol>\n      </div>\n      <div class="col-xs-4">\n        <div class="form-inline pull-right">\n          <div class="form-group">\n            <span class="input-group input-group-sm no-padding-top">\n              <span class="input-group-addon"><i class="glyphicon glyphicon-filter"></i></span>\n              <input ng-keyup="filterTaxonomiesKeyUp($event)" ng-model="taxonomies.search.text" type="text"\n                class="form-control ng-pristine ng-untouched ng-valid" aria-describedby="study-search">\n            </span>\n            <span ng-click="closeTaxonomies()" title="{{\'close\' | translate}}" class="hoffset3"><i\n              class="fa fa-close"></i></span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="panel-body">\n    <div ng-if="!taxonomies.search.active && taxonomies.all.length === 0" translate>\n      no-classifications\n    </div>\n    <div ng-if="taxonomies.search.active" class="loading"></div>\n\n    <div ng-if="!taxonomies.taxonomy">\n      <div ng-repeat="taxonomy in taxonomies.all" ng-if="$index % 3 == 0" class="row">\n        <div class="col-xs-4">\n          <div taxonomy-panel taxonomy="taxonomies.all[$index]" lang="lang" on-navigate="navigateTaxonomy"></div>\n        </div>\n        <div class="col-xs-4">\n          <div taxonomy-panel taxonomy="taxonomies.all[$index + 1]" lang="lang" on-navigate="navigateTaxonomy"></div>\n        </div>\n        <div class="col-xs-4">\n          <div taxonomy-panel taxonomy="taxonomies.all[$index + 2]" lang="lang" on-navigate="navigateTaxonomy"></div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-if="taxonomies.taxonomy && !taxonomies.vocabulary">\n      <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </p>\n      <div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n        <div class="col-xs-4">\n          <div vocabulary-panel taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index]"\n            lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n        <div class="col-xs-4">\n          <div vocabulary-panel taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 1]"\n            lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n        <div class="col-xs-4">\n          <div vocabulary-panel taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 2]"\n            lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary">\n      <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </p>\n      <div ng-repeat="term in taxonomies.vocabulary.terms" ng-if="$index % 3 == 0" class="row">\n        <div class="col-xs-4">\n          <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary"\n            term="taxonomies.vocabulary.terms[$index]" lang="lang" on-select="selectTerm"></div>\n        </div>\n        <div class="col-xs-4">\n          <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary"\n            term="taxonomies.vocabulary.terms[$index + 1]" lang="lang" on-select="selectTerm"></div>\n        </div>\n        <div class="col-xs-4">\n          <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary"\n            term="taxonomies.vocabulary.terms[$index + 2]" lang="lang" on-select="selectTerm"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/taxonomy-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/taxonomy-panel-template.html",'<div>\n  <h4 ng-repeat="label in taxonomy.title" ng-if="label.locale === lang">\n    <a href ng-click="onNavigate(taxonomy)">{{label.text}}</a>\n  </h4>\n  <p class="help-block" ng-repeat="label in taxonomy.description" ng-if="label.locale === lang">\n    {{label.text}}\n  </p>\n  <ul>\n    <li ng-repeat="vocabulary in taxonomy.vocabularies" ng-if="$index<4">\n      <a href ng-click="onNavigate(taxonomy, vocabulary)">\n        <span ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </span>\n        <span ng-if="!vocabulary.title">\n          {{vocabulary.name}}\n        </span>\n      </a>\n    </li>\n    <div class="collapse" id="{{taxonomy.name + \'_vocabularies\'}}">\n      <li ng-repeat=" vocabulary in taxonomy.vocabularies" ng-if="$index>=4">\n        <a href ng-click="onNavigate(taxonomy, vocabulary)">\n          <span ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n            {{label.text}}\n          </span>\n          <span ng-if="!vocabulary.title">\n            {{vocabulary.name}}\n          </span>\n        </a>\n      </li>\n    </div>\n    <li ng-if="taxonomy.vocabularies && taxonomy.vocabularies.length>4" class="list-unstyled">\n      <a data-toggle="collapse" data-target="#{{taxonomy.name + \'_vocabularies\'}}">\n        <i class="fa fa-arrow-down"></i>\n      </a>\n    </li>\n  </ul>\n</div>')}]),angular.module("search/views/taxonomy-template.html",[]).run(["$templateCache",function(a){a.put("search/views/taxonomy-template.html",'<div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n  <div class="col-xs-4">\n    <div vocabulary-panel taxonomy="taxonomies.taxonomy.vocabularies[$index]"></div>\n  </div>\n  <div class="col-xs-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 1]"></div>\n  </div>\n  <div class="col-xs-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 2]"></div>\n  </div>\n</div>')}]),angular.module("search/views/term-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/term-panel-template.html",'<div>\n  <h4 ng-repeat="label in term.title" ng-if="label.locale === lang">\n    {{label.text}}\n    <small>\n    <a href ng-click="onSelect(target, taxonomy, vocabulary, term)">\n      <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n    </a>\n    </small>\n  </h4>\n  <p ng-repeat="label in term.description" ng-if="label.locale === lang">\n    <span class="help-block">{{label.text}}</span>\n  </p>\n</div>')}]),angular.module("search/views/variables-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/variables-search-result-table-template.html",'<div ng-show="summaries.length > 0">\n  <div class="row voffset2">\n    <div class="col-xs-4">\n    </div>\n    <div class="col-xs-8">\n      <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n    </div>\n  </div>\n\n  <div class="table-responsive">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th translate>name</th>\n        <th translate>label</th>\n        <th translate>study</th>\n        <th translate>dataset</th>\n      </tr>\n      </thead>\n      <tbody>\n\n      <tr ng-repeat="summary in summaries">\n        <td>\n          {{summary.name}}\n        </td>\n        <td>\n          <localized value="summary.variableLabel" lang="lang"></localized>\n        </td>\n        <td>\n          <localized value="summary.studyAcronym" lang="lang"></localized>\n        </td>\n        <td>\n          <localized value="summary.datasetAcronym" lang="lang"></localized>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("search/views/vocabulary-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/vocabulary-panel-template.html",'<div>\n  <h4 ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n    <a href ng-click="onNavigate(taxonomy, vocabulary)">{{label.text}}</a>\n  </h4>\n  <h4 ng-if="!vocabulary.title">\n    <a href ng-click="onNavigate(taxonomy, vocabulary)">{{vocabulary.name}}</a>\n  </h4>\n  <p class="help-block" ng-repeat="label in vocabulary.description" ng-if="label.locale === lang">\n    {{label.text}}\n  </p>\n  <ul>\n    <li ng-repeat="term in vocabulary.terms" ng-if="$index<4">\n      <span ng-repeat="label in term.title" ng-if="label.locale === lang">\n        {{label.text}}\n      </span>\n      <span ng-if="!term.title">\n        {{term.name}}\n      </span>\n      <a href ng-click="onSelect(taxonomy, vocabulary, term)">\n        <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n      </a>\n    </li>\n    <div class="collapse" id="{{taxonomy.name + vocabulary.name + \'_terms\'}}">\n      <li ng-repeat="term in vocabulary.terms" ng-if="$index>=4">\n        <span ng-repeat="label in term.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </span>\n        <span ng-if="!term.title">\n          {{term.name}}\n        </span>\n        <a href ng-click="onSelect(taxonomy, vocabulary, term)">\n          <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n        </a>\n      </li>\n    </div>\n    <li ng-if="vocabulary.terms && vocabulary.terms.length>4" class="list-unstyled">\n      <a data-toggle="collapse" data-target="#{{taxonomy.name + vocabulary.name + \'_terms\'}}">\n        <i class="fa fa-arrow-down"></i>\n      </a>\n    </li>\n  </ul>\n</div>')}]);