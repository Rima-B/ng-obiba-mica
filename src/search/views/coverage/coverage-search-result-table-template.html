<div>
  <div ng-if="hasVariableTarget()">
    <ul class="nav nav-pills pull-left">
      <li ng-class="{active: bucket === BUCKET_TYPES.STUDY || bucket === BUCKET_TYPES.DCE}">
        <a href ng-click="selectBucket(BUCKET_TYPES.STUDY)" translate>search.coverage-buckets.study</a>
      </li>
      <li ng-class="{active: bucket === BUCKET_TYPES.DATASET || bucket === BUCKET_TYPES.DATASCHEMA}">
        <a href ng-click="selectBucket(BUCKET_TYPES.DATASET)" translate>search.coverage-buckets.datasetNav</a>
      </li>
      <li ng-class="{active: bucket === BUCKET_TYPES.NETWORK}">
        <a href ng-click="selectBucket(BUCKET_TYPES.NETWORK)" translate>search.coverage-buckets.network</a>
      </li>
    </ul>

    <div class="pull-right">
      <a ng-if="hasSelected()" href class="btn btn-default" ng-click="updateFilterCriteria()">
        <i class="fa fa-filter"></i> {{'search.filter' | translate}}
      </a>
      <a ng-if="table.taxonomyHeaders.length > 0" target="_self" class="btn btn-info btn-responsive"
        ng-href="{{downloadUrl()}}">
        <i class="fa fa-download"></i> {{'download' | translate}}
      </a>
    </div>

    <div class="clearfix"></div>

    <div class="voffset2" ng-if="bucket === BUCKET_TYPES.STUDY || bucket === BUCKET_TYPES.DCE">
      <label class="checkbox-inline">
        <input type="checkbox" ng-model="bucketSelection.dceBucketSelected">
        <span translate>search.coverage-buckets.dce</span>
      </label>
    </div>

    <div class="voffset2" ng-if="bucket === BUCKET_TYPES.DATASET || bucket === BUCKET_TYPES.DATASCHEMA">
      <label class="radio-inline">
        <input type="radio" ng-model="bucketSelection.datasetBucketSelected" ng-value="true">
        <span translate>search.coverage-buckets.dataset</span>
      </label>
      <label class="radio-inline">
        <input type="radio" ng-model="bucketSelection.datasetBucketSelected" ng-value="false">
        <span translate>search.coverage-buckets.dataschema</span>
      </label>
    </div>
  </div>

  <p class="help-block" ng-if="!loading && !table.taxonomyHeaders">
    <span ng-if="!hasVariableTarget()" translate>search.no-coverage</span>
    <span ng-if="hasVariableTarget()" translate>search.no-results</span>
  </p>

  <div ng-if="loading" class="loading"></div>

  <div class="table-responsive" ng-if="table.taxonomyHeaders.length > 0">
    <table class="table table-bordered table-striped">
      <thead>
      <tr>
        <th rowspan="2" width="20px"></th>
        <th rowspan="{{bucket === BUCKET_TYPES.DCE ? 1 : 2}}" colspan="{{table.cols.colSpan}}" translate>
          {{'search.coverage-buckets.' + bucket}}
        </th>
        <th ng-repeat="header in table.vocabularyHeaders" colspan="{{header.termsCount}}">
          <span
            uib-popover="{{header.entity.descriptions[0].value}}"
            popover-title="{{header.entity.titles[0].value}}"
            popover-placement="bottom"
            popover-trigger="mouseenter">
          {{header.entity.titles[0].value}}
            </span>
        </th>
      </tr>
      <tr>
        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.study</th>
        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.population</th>
        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.dce</th>
        <th ng-repeat="header in table.termHeaders">
          <span
            uib-popover="{{header.entity.descriptions[0].value}}"
            popover-title="{{header.entity.titles[0].value}}"
            popover-placement="bottom"
            popover-trigger="mouseenter">
          {{header.entity.titles[0].value}}
            </span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="row in table.rows" ng-if="showMissing || table.termHeaders.length == keys(row.hits).length">
        <td><input type="checkbox" ng-model="row.selected"></td>
        <td ng-repeat="col in table.cols.ids[row.value]" rowspan="{{col.rowSpan}}" ng-if="col.rowSpan > 0">
          <a href="{{col.url ? col.url : ''}}"
            uib-popover-html="col.description === col.title ? null : col.description"
            popover-title="{{col.title}}"
            popover-placement="bottom"
            popover-trigger="mouseenter">{{col.title}}</a>
        </td>
        <td ng-repeat="h in table.termHeaders">
          <a href ng-click="updateCriteria(row.value, h, $index, 'variables')"><span class="label label-info"
            ng-if="row.hits[$index]">{{row.hits[$index]}}</span></a>
          <span ng-if="!row.hits[$index]">0</span>
        </td>
      </tr>
      </tbody>
      <tfoot>
      <tr>
        <th></th>
        <th colspan="{{table.cols.colSpan}}" translate>all</th>
        <th ng-repeat="header in table.termHeaders" title="{{header.entity.descriptions[0].value}}">
          <a href ng-click="updateCriteria(null, header, $index, 'variables')">{{header.hits}}</a>
        </th>
      </tr>
      </tfoot>
    </table>
  </div>

  <!--<pre>-->
  <!--{{table.cols | json}}-->
  <!--</pre>-->
</div>